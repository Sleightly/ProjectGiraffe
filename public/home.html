<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Swap</title>
    <link rel="icon" href="images/icon.png">
    <link href="https://fonts.googleapis.com/css?family=Mukta:200,300,400,500,600,700,800" rel="stylesheet">
    <script src="js/jquery.min.js"></script>
    <link rel="stylesheet" type="text/css" href="styles/jTinder.css">
    <link rel="stylesheet" type="text/css" href="styles/home.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css" integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" crossorigin="anonymous">
    <script src="https://www.gstatic.com/firebasejs/5.9.2/firebase.js"></script>
    <script>
      // Initialize Firebase
      var config = {
        apiKey: "AIzaSyD-6L1HaTNNWgkzacsDiD2mhrOW5OCNsaE",
        authDomain: "project-giraffe-4c1a9.firebaseapp.com",
        databaseURL: "https://project-giraffe-4c1a9.firebaseio.com",
        projectId: "project-giraffe-4c1a9",
        storageBucket: "project-giraffe-4c1a9.appspot.com",
        messagingSenderId: "836183447667"
      };
      firebase.initializeApp(config);
    </script>
  </head>
  <body>
    <nav>
      <a href="home.html" id="brand">
        <img src="images/logo.png">
      </a>
      <div>
        <a href="message.html">
          <img src="images/message.png">
        </a>
        <a href="profile.html">
          <img src="images/profile.png">
        </a>
      </div>
    </nav>
    <div class="cards">
      <!-- i used jTinder, i can easily populate the cards dynamically these are just placeholder, also you can take look, there are some callback functions available for if something is liked or disliked for y'all to store in the database-->
      <div id="tinderslide">
        <p id="nomore">No More<br>To Browse</p>
        <ul id="tinderslideul">
        </ul>
      </div>
    </div>
    <div class="instructions">
      <p id="right">Swipe Right to <span style="color: green;">LIKE <i class="fas fa-heart"></i></span></p><br>
      <p id="left">Swipe Left to <span style="color: crimson;">PASS <i class="fas fa-times"></i></span></p>
    </div>
    <div class="modal" id="modal" style="display: none;">
      <div class="inner-modal">
        <h1>It's a match!</h1>
        <p>Socks and Spoon</p>
        <div style="display: flex; flex-direction: row; justify-content: center;">
          <button onclick="closeModal()">Keep Browsing</button>
          <button onclick="chatWith()">Start Chatting</button>
        </div>
      </div>
    </div>
    <script type="text/javascript" src="scripts/main.js"></script>
    <script type="text/javascript" src="scripts/matching.js"></script>
    <script>
<<<<<<< HEAD
      var auth = false;
      window.onload = function(e){
        firebase.auth().onAuthStateChanged(function(user) {
          if (!user) {
            window.location.href = 'index.html';
          } else {
            var itemArray = [];
            var i = 1;
            var order = matchingMapGeneration(firebase.auth().currentUser.uid);
            while (order.length>0) {
              //find the Max
              var max = 0;
              for(var j = 0; j<order.length; j++){
                if(order[max]<order[j]){
                  max = j;
                }
              }
=======
      var itemArray = [];
      var ref = firebase.firestore().collection("items")
        .get()
        .then(function(querySnapshot) {
          var order = matchingMapGeneration(getUniqueId());
          for(var i = 0; i<order.length; i++){
            doc = firebase.firestore().collection("items").where('id','=',order[i]).get();
            createCard(doc.data(), i);
            addItem(doc.data().imageUrl);
          }
        }).then(function() {
          var script = document.createElement('script'),
          scripts = document.getElementsByTagName('script')[0];
          script.src = 'js/jquery.transform2d.js';
          scripts.parentNode.insertBefore(script, scripts);
        }).then(function() {
          var script = document.createElement('script'),
          scripts = document.getElementsByTagName('script')[0];
          script.src = 'js/jquery.jTinder.js';
          scripts.parentNode.insertBefore(script, scripts);
          document.getElementById('nomore').style.display = 'block';
        }).then(function() {
          setTimeout(function() {
            passArray(itemArray);
          }, 600);
        })
        .catch(function(error) {
          console.log("Error getting documents: ", error);
        });
>>>>>>> b1b2f2d93cb33a11ec64022b8b897bf975272897

              createCard(getBloc(max), i);
              addItem(getBloc(max).imageUrl);
              order.splice(max);
              i++;
            }

            var ref = firebase.firestore().collection("items")
              .get()
              .then(function(querySnapshot) {querySnapshot.forEach(function(doc) {
                });
              }).then(function() {
                var script = document.createElement('script'),
                scripts = document.getElementsByTagName('script')[0];
                script.src = 'js/jquery.transform2d.js';
                scripts.parentNode.insertBefore(script, scripts);
              }).then(function() {
                var script = document.createElement('script'),
                scripts = document.getElementsByTagName('script')[0];
                script.src = 'js/jquery.jTinder.js';
                scripts.parentNode.insertBefore(script, scripts);
                document.getElementById('nomore').style.display = 'block';
              }).then(function() {
                setTimeout(function() {
                  passArray(itemArray);
                }, 600);
              })
              .catch(function(error) {
                console.log("Error getting documents: ", error);
              });

            function createCard(item, num) {
              var elem = `<li class="pane${num}"><div class="img" style="background: url('${item.imageUrl}') no-repeat scroll center center; background-size: cover;"></div><div>${item.title}</div><div class="like"></div><div class="dislike"></div></li>`;
              document.getElementById('tinderslideul').innerHTML += elem;
            }

            function addItem(url) {
              itemArray.push(url);
            }

            function closeModal() {
              document.getElementsByClassName('modal')[0].style.display = 'none';
            }

            document.body.addEventListener('click', function temp(e) {
              console.log('added');
              if(e.target.id === 'modal') {
                document.body.removeEventListener('click', temp);
                closeModal();
              }
            })
          }
        });
      }
    </script>
  </body>
</html>
